<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Porsche.js API documentation: Source: ui/view/textfield.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link href="styles/bootstrap.css" rel="stylesheet">
    <link href="styles/docs.css" rel="stylesheet">
    <link href="styles/bootstrap-custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
  </head>
  <body>
    <header class="header navbar navbar-inverse">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#"><strong>Porsche.js</strong> API documentation</a>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <div class="row-fluid">
          <div class="span3">
              <h2><a href="index.html">Index</a></h2><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Modules</li><li><a href="module-AutoLayout.html">AutoLayout</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Classes</li><li><a href="App.html"><i class="icon-shield" style="color: #0186d1"></i> App</a></li><li><a href="EventEmitter.html"><i class="icon-shield" style="color: #0186d1"></i> EventEmitter</a></li><li><a href="CubicBezier.html"><i class="icon-shield" style="color: #0186d1"></i> CubicBezier</a></li><li><a href="Event.html"><i class="icon-shield" style="color: #0186d1"></i> Event</a></li><li><a href="GestureEvent.html"><i class="icon-shield" style="color: #0186d1"></i> GestureEvent</a></li><li><a href="InputEvent.html"><i class="icon-shield" style="color: #0186d1"></i> InputEvent</a></li><li><a href="KeyboardEvent.html"><i class="icon-shield" style="color: #0186d1"></i> KeyboardEvent</a></li><li><a href="TouchEvent.html"><i class="icon-shield" style="color: #0186d1"></i> TouchEvent</a></li><li><a href="UIEvent.html"><i class="icon-shield" style="color: #0186d1"></i> UIEvent</a></li><li><a href="initialize.html"><i class="icon-shield" style="color: #0186d1"></i> initialize</a></li><li><a href="LongPressRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> LongPressRecognizer</a></li><li><a href="PanRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> PanRecognizer</a></li><li><a href="PinchRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> PinchRecognizer</a></li><li><a href="RotationRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> RotationRecognizer</a></li><li><a href="SwipeRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> SwipeRecognizer</a></li><li><a href="TapRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> TapRecognizer</a></li><li><a href="module-AutoLayout-View.html"><i class="icon-shield" style="color: #0186d1"></i> View</a></li><li><a href="ColumnLayout.html"><i class="icon-shield" style="color: #0186d1"></i> ColumnLayout</a></li><li><a href="ColumnLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> ColumnLayoutParam</a></li><li><a href="FlowLayout.html"><i class="icon-shield" style="color: #0186d1"></i> FlowLayout</a></li><li><a href="FlowLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> FlowLayoutParam</a></li><li><a href="GridLayout.html"><i class="icon-shield" style="color: #0186d1"></i> GridLayout</a></li><li><a href="GridLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> GridLayoutParam</a></li><li><a href="Layout.html"><i class="icon-shield" style="color: #0186d1"></i> Layout</a></li><li><a href="RelativeLayout.html"><i class="icon-shield" style="color: #0186d1"></i> RelativeLayout</a></li><li><a href="RowLayout.html"><i class="icon-shield" style="color: #0186d1"></i> RowLayout</a></li><li><a href="RowLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> RowLayoutParam</a></li><li><a href="Matrix.html"><i class="icon-shield" style="color: #0186d1"></i> Matrix</a></li><li><a href="Point.html"><i class="icon-shield" style="color: #0186d1"></i> Point</a></li><li><a href="Rectangle.html"><i class="icon-shield" style="color: #0186d1"></i> Rectangle</a></li><li><a href="BarCode.html"><i class="icon-shield" style="color: #0186d1"></i> BarCode</a></li><li><a href="Button.html"><i class="icon-shield" style="color: #0186d1"></i> Button</a></li><li><a href="Chart.html"><i class="icon-shield" style="color: #0186d1"></i> Chart</a></li><li><a href="CheckBox.html"><i class="icon-shield" style="color: #0186d1"></i> CheckBox</a></li><li><a href="CircleProgressView.html"><i class="icon-shield" style="color: #0186d1"></i> CircleProgressView</a></li><li><a href="CompositeView.html"><i class="icon-shield" style="color: #0186d1"></i> CompositeView</a></li><li><a href="Dialog.html"><i class="icon-shield" style="color: #0186d1"></i> Dialog</a></li><li><a href="ImageButton.html"><i class="icon-shield" style="color: #0186d1"></i> ImageButton</a></li><li><a href="ImageView.html"><i class="icon-shield" style="color: #0186d1"></i> ImageView</a></li><li><a href="Indicator.html"><i class="icon-shield" style="color: #0186d1"></i> Indicator</a></li><li><a href="ListItem.html"><i class="icon-shield" style="color: #0186d1"></i> ListItem</a></li><li><a href="ListView.html"><i class="icon-shield" style="color: #0186d1"></i> ListView</a></li><li><a href="ProgressView.html"><i class="icon-shield" style="color: #0186d1"></i> ProgressView</a></li><li><a href="QRCode.html"><i class="icon-shield" style="color: #0186d1"></i> QRCode</a></li><li><a href="RichTextView.html"><i class="icon-shield" style="color: #0186d1"></i> RichTextView</a></li><li><a href="ScrollableView.html"><i class="icon-shield" style="color: #0186d1"></i> ScrollableView</a></li><li><a href="ScrollBar.html"><i class="icon-shield" style="color: #0186d1"></i> ScrollBar</a></li><li><a href="Slider.html"><i class="icon-shield" style="color: #0186d1"></i> Slider</a></li><li><a href="StackView.html"><i class="icon-shield" style="color: #0186d1"></i> StackView</a></li><li><a href="SwipeView.html"><i class="icon-shield" style="color: #0186d1"></i> SwipeView</a></li><li><a href="Switch.html"><i class="icon-shield" style="color: #0186d1"></i> Switch</a></li><li><a href="TextField.html"><i class="icon-shield" style="color: #0186d1"></i> TextField</a></li><li><a href="TextView.html"><i class="icon-shield" style="color: #0186d1"></i> TextView</a></li><li><a href="View.html"><i class="icon-shield" style="color: #0186d1"></i> View</a></li><li><a href="Window.html"><i class="icon-shield" style="color: #0186d1"></i> Window</a></li><li><a href="YObject.html"><i class="icon-shield" style="color: #0186d1"></i> YObject</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Namespaces</li><li><a href="VisualFormat.html"><i class="icon-code"></i> VisualFormat</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Global</li><li><a href="global.html#createInput"><i class="icon-globe" style="color: black;"></i> createInput</a></li><li><a href="global.html#add"><i class="icon-globe" style="color: black;"></i> add</a></li><li><a href="global.html#remove"><i class="icon-globe" style="color: black;"></i> remove</a></li><li><a href="global.html#emit"><i class="icon-globe" style="color: black;"></i> emit</a></li><li><a href="global.html#stop"><i class="icon-globe" style="color: black;"></i> stop</a></li><li><a href="global.html#recognize"><i class="icon-globe" style="color: black;"></i> recognize</a></li><li><a href="global.html#set"><i class="icon-globe" style="color: black;"></i> set</a></li><li><a href="global.html#recognizeWith"><i class="icon-globe" style="color: black;"></i> recognizeWith</a></li><li><a href="global.html#dropRecognizeWith"><i class="icon-globe" style="color: black;"></i> dropRecognizeWith</a></li><li><a href="global.html#requireFailure"><i class="icon-globe" style="color: black;"></i> requireFailure</a></li><li><a href="global.html#dropRequireFailure"><i class="icon-globe" style="color: black;"></i> dropRequireFailure</a></li><li><a href="global.html#hasRequireFailures"><i class="icon-globe" style="color: black;"></i> hasRequireFailures</a></li><li><a href="global.html#canRecognizeWith"><i class="icon-globe" style="color: black;"></i> canRecognizeWith</a></li><li><a href="global.html#tryEmit"><i class="icon-globe" style="color: black;"></i> tryEmit</a></li><li><a href="global.html#canEmit"><i class="icon-globe" style="color: black;"></i> canEmit</a></li><li><a href="global.html#stateStr"><i class="icon-globe" style="color: black;"></i> stateStr</a></li><li><a href="global.html#directionStr"><i class="icon-globe" style="color: black;"></i> directionStr</a></li><li><a href="global.html#process"><i class="icon-globe" style="color: black;"></i> process</a></li><li><a href="global.html#reset"><i class="icon-globe" style="color: black;"></i> reset</a></li><li><a href="global.html#handleInputEvent"><i class="icon-globe" style="color: black;"></i> handleInputEvent</a></li><li><a href="global.html#computeInputData"><i class="icon-globe" style="color: black;"></i> computeInputData</a></li><li><a href="global.html#simpleCloneInputData"><i class="icon-globe" style="color: black;"></i> simpleCloneInputData</a></li><li><a href="global.html#computeIntervalInputData"><i class="icon-globe" style="color: black;"></i> computeIntervalInputData</a></li><li><a href="global.html#getCenter"><i class="icon-globe" style="color: black;"></i> getCenter</a></li><li><a href="global.html#getVelocity"><i class="icon-globe" style="color: black;"></i> getVelocity</a></li><li><a href="global.html#getDirection"><i class="icon-globe" style="color: black;"></i> getDirection</a></li><li><a href="global.html#getDistance"><i class="icon-globe" style="color: black;"></i> getDistance</a></li><li><a href="global.html#getAngle"><i class="icon-globe" style="color: black;"></i> getAngle</a></li><li><a href="global.html#getRotation"><i class="icon-globe" style="color: black;"></i> getRotation</a></li><li><a href="global.html#getScale"><i class="icon-globe" style="color: black;"></i> getScale</a></li><li><a href="global.html#hasParent"><i class="icon-globe" style="color: black;"></i> hasParent</a></li><li><a href="global.html#normalizeSingleTouches"><i class="icon-globe" style="color: black;"></i> normalizeSingleTouches</a></li><li><a href="global.html#attrTest"><i class="icon-globe" style="color: black;"></i> attrTest</a></li><li><a href="global.html#getTouches"><i class="icon-globe" style="color: black;"></i> getTouches</a></li><li><a href="global.html#Attribute"><i class="icon-globe" style="color: black;"></i> Attribute</a></li><li><a href="global.html#Relation"><i class="icon-globe" style="color: black;"></i> Relation</a></li><li><a href="global.html#Priority"><i class="icon-globe" style="color: black;"></i> Priority</a></li><li><a href="global.html#value"><i class="icon-globe" style="color: black;"></i> value</a></li><li><a href="global.html#defineClass"><i class="icon-globe" style="color: black;"></i> defineClass</a></li><li><a href="global.html#getClass"><i class="icon-globe" style="color: black;"></i> getClass</a></li><li><a href="global.html#checkLineBreak"><i class="icon-globe" style="color: black;"></i> checkLineBreak</a></li><li><a href="global.html#isHex"><i class="icon-globe" style="color: black;"></i> isHex</a></li><li><a href="global.html#isNumber"><i class="icon-globe" style="color: black;"></i> isNumber</a></li><li><a href="global.html#isEmpty"><i class="icon-globe" style="color: black;"></i> isEmpty</a></li><li><a href="global.html#trim"><i class="icon-globe" style="color: black;"></i> trim</a></li><li><a href="global.html#focus"><i class="icon-globe" style="color: black;"></i> focus</a></li><li><a href="global.html#blur"><i class="icon-globe" style="color: black;"></i> blur</a></li><li><a href="global.html#addGestureRecognizer"><i class="icon-globe" style="color: black;"></i> addGestureRecognizer</a></li><li><a href="global.html#removeGestureRecognizer"><i class="icon-globe" style="color: black;"></i> removeGestureRecognizer</a></li><li><a href="global.html#toString"><i class="icon-globe" style="color: black;"></i> toString</a></li></ul></div>
          </div>

          <div class="span9">
              <h1 class="page-header">Source: ui/view/textfield.js</h1>
              


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
* Porsche.js is licensed under the MIT license. If a copy of the
* MIT-license was not distributed with this file, You can obtain one at:
* http://opensource.org/licenses/mit-license.html.
*
* @author: Yang Yang (compking@gmail.com)
* @license MIT
* @copyright Yang Yang, 2015
*/

"use strict";
var Class = require("../../class");
var TextView = require("./textview");
var TapRecognizer = require("../gesture/taprecognizer");
var Point = require("../point");

/**
 * Text field.
 * @class TextField
 * @extends TextView
 */
Class.define("framework.ui.view.TextField", TextView, {
    /**
     * Constructor that create a view
     * @constructor
     */
    initialize: function() {
        TextView.prototype.initialize.apply(this, arguments);

        if (!global.hasOwnProperty("textFields")) {
            global.textFields = [];
        }
        global.textFields.push(this);

        this._readonly = false;
        this._maxlength = 0;
        this._padding = 0;
        this._alignCenter = false;
        this._borderWidth = 1;
        this._borderColor = "#959595";
        this._borderRadius = 3;
        this._selectionColor = "rgba(179, 212, 253, 0.8)";
        this._inputIndex = global.textFields.length - 1;
        this._color = "#000000";
        this._background = "#FFFFFF";
        this._cursorColor = "#0000FF";
        this._placeholderColor = "#BFBEBD";
        this._placeholder = "";
        this._selection = {start: -1, end: -1};

        this._cursor = false;
        this._cursorPos = 0;
        this._cursorInterval = null;
        this._selectionStartPoint = new Point(0, 0);
        this._selectionLastPoint = new Point(0, 0);
        this._wasOver = false;

        this.addGestureRecognizer(this._tapRecognizer = new TapRecognizer());
        this.addEventListener("touchstart", this._onTouchStartFunc = this.onTouchStart.bind(this));
        this.addEventListener("touchmove", this._onTouchMoveFunc = this.onTouchMove.bind(this));
        this.addEventListener("touchend", this._onTouchEndCancelFunc = this.onTouchEndCancel.bind(this));
        this.addEventListener("touchcancel", this._onTouchEndCancelFunc);
        this.addEventListener("keydown", this._onKeyDownFunc = this.onKeyDown.bind(this));
        this.addEventListener("keyup", this._onKeyUpFunc = this.onKeyUp.bind(this));
    },

    destroy: function() {
        this.removeGestureRecognizer(this._tapRecognizer);
        this._tapRecognizer.destroy();
        this._tapRecognizer = null;

        this.removeEventListener("touchstart", this._onTouchStartFunc);
        this._onTouchStartFunc = null;

        this.removeEventListener("touchmove", this._onTouchMoveFunc);
        this._onTouchMoveFunc = null;

        this.removeEventListener("touchend", this._onTouchEndCancelFunc);
        this.removeEventListener("touchcancel", this._onTouchEndCancelFunc);
        this._onTouchEndCancelFunc = null;

        this.removeEventListener("keydown", this._onKeyDownFunc);
        this._onKeyDownFunc = null;

        this.removeEventListener("keyup", this._onKeyUpFunc);
        this._onKeyUpFunc = null;

        this._selectionStartPoint.destroy();
        this._selectionStartPoint = null;

        this._selectionLastPoint.destroy();
        this._selectionLastPoint = null;

        TextView.prototype.destroy.apply(this, arguments);
    },

    /**
     * @name TextView#text
     * @type {String}
     * @description Text content.
     */
    get text() {
        return this._text;
    },

    set text(value) {
        this._text = value;
        this._cursorPos = this._text.length;
        this.invalidate();
    },

    get placeholder() {
        return this._placeholder;
    },

    set placeholder(value) {
        this._placeholder = value;
        this.invalidate();
    },

    onTouchStart: function(e) {
        var x = e.targetTouches[0].pageX;
        var y = e.targetTouches[0].pageY;

        this.focus();
        // start the selection drag if inside the input
        if (this._focused) {
            this._selectionStartPoint.assign(x, y);
            this.invalidate();
        }
    },

    onTouchMove: function(e) {
        var x = e.targetTouches[0].pageX;
        var y = e.targetTouches[0].pageY;

        if (this._focused) {
            this._selectionLastPoint.assign(x, y);
            this.invalidate();
        }
    },

    onTouchEndCancel: function(/*e*/) {
        if (this._focused) {
            this._selectionStartPoint.assign(-1, -1);
            this._selectionLastPoint.assign(-1, -1);
            this.invalidate();
        }
    },

    onKeyDown: function(e) {
        if (this._focused) {
            // e.preventDefault();
            var cursorVal = true;
            if (e.keyCode === 8) {
                // Pressed Backspace key
                if (this._cursorPos > 0) {
                    this._text = this._text.substr(0, this._cursorPos - 1) + this._text.substr(this._cursorPos, this._text.length);
                    this._cursorPos--;
                }
            } else if (e.keyCode === 46) {
                // Pressed Delete key
                if (this._cursorPos &lt; this._text.length) {
                    this._text = this._text.substr(0, this._cursorPos) + this._text.substr(this._cursorPos + 1, this._text.length);
                }
            } else if (e.keyCode === 37) {
                // Pressed Left arrow key
                if (this._cursorPos > 0) {
                    this._cursorPos--;
                }
            } else if (e.keyCode === 39) {
                // Pressed Right arrow key
                if (this._cursorPos &lt; this._text.length) {
                    this._cursorPos++;
                }
            } else if (e.keyCode === 13) {
                // Pressed Enter key
                cursorVal = false;
            } else if (e.keyCode === 9) {
                // Pressed Tab key
                cursorVal = false;
                // this.blur();
                // var obj = global.textFields[this._inputIndex + 1];
                // if (obj !== undefined) {
                //     setTimeout(function() {
                //         return obj.focus();
                //     }.bind(this), 1);
                // }
            } else if (e.keyCode === 65 &amp;&amp; (e.ctrlKey || e.metaKey)) {
                // Pressed Ctrl/Cmd+A to selection all
                this.selectText(0, this._text.length);
            } else {
                // Pressed other keys
                var key = this.mapKeyPressToActualCharacter(e.shiftKey, e.keyCode);
                if (key !== null) {
                    this._text = this._text.substr(0, this._cursorPos) + key + this._text.substr(this._cursorPos, this._text.length);
                    this._cursorPos++;
                }
            }
            this._cursor = cursorVal;
            this.invalidate();
        }
    },

    onKeyUp: function(e) {
        this.invalidate();
    },

    /**
     * Place focus on the text field, placing the cursor
     * either at the end of the text or where the user clicked.
     */
    focus: function() {
        if (this._focused) {
            return;
        }

        // remove focus from all other inputs
        for (var i = 0; i &lt; global.textFields.length; i++) {
            if (global.textFields[i].focused) {
                global.textFields[i].blur();
            }
        }

        this._focused = true;
        this._selection.start = -1;
        this._selection.end = -1;
        this._cursor = true;

        if (this._cursorInterval !== null) {
            clearInterval(this._cursorInterval);
            this._cursorInterval = null;
        }
        this._cursorInterval = setInterval(function() {
            this._cursor = !this._cursor;
            this.invalidate();
        }.bind(this), 500);

        this.invalidate();
    },

    /**
     * Removes focus from the CanvasInput box.
     */
    blur: function() {
        this._focused = false;
        if (this._cursorInterval !== null) {
            clearInterval(this._cursorInterval);
            this._cursorInterval = null;
        }
        this._selection.start = -1;
        this._selection.end = -1;
        this._cursor = false;
        this.invalidate();
    },

    selectText: function(start, end) {
        this._selection.start = start;
        this._selection.end = end;
        this.invalidate();
    },

    removeSelectedText: function() {
        if (this._selection.start >= 0) {
            // clear the selected contents
            var start = this._selection.start;
            var end = this._selection.end;
            this._text = this._text.substr(0, start) + this._text.substr(end);
            this._cursorPos = start;
            this._selection.start = 0;
            this._selection.end = 0;
        }
    },

    mapKeyPressToActualCharacter: function(isShiftKey, characterCode) {
        if (characterCode === 27 || characterCode === 8 || characterCode === 9 || characterCode === 20 || characterCode === 16 || characterCode === 17 || characterCode === 91 || characterCode === 13 || characterCode === 92 || characterCode === 18) {
            return null;
        }
        if (typeof isShiftKey !== "boolean" || typeof characterCode !== "number") {
            return null;
        }
        var characterMap = [];
        characterMap[192] = "~";
        characterMap[49] = "!";
        characterMap[50] = "@";
        characterMap[51] = "#";
        characterMap[52] = "$";
        characterMap[53] = "%";
        characterMap[54] = "^";
        characterMap[55] = "&amp;";
        characterMap[56] = "*";
        characterMap[57] = "(";
        characterMap[48] = ")";
        characterMap[109] = "_";
        characterMap[107] = "+";
        characterMap[219] = "{";
        characterMap[221] = "}";
        characterMap[220] = "|";
        characterMap[59] = ":";
        characterMap[222] = "\"";
        characterMap[188] = "&lt;";
        characterMap[190] = ">";
        characterMap[187] = "+";
        characterMap[191] = "?";
        characterMap[32] = " ";

        var character = "";
        if (isShiftKey) {
            if (characterCode >= 65 &amp;&amp; characterCode &lt;= 90) {
                character = String.fromCharCode(characterCode);
            } else {
                character = characterMap[characterCode];
            }
        } else {
            if (characterCode >= 65 &amp;&amp; characterCode &lt;= 90) {
                character = String.fromCharCode(characterCode).toLowerCase();
            } else {
                if (characterCode === 188) {
                    character = ",";
                } else if (characterCode === 190) {
                    character = ".";
                } else {
                    character = String.fromCharCode(characterCode);
                }
            }
        }
        return character;
    },

    drawBackground: function(context) {
        // Draw background
        context.save();
        context.fillStyle = this._background;
        context.roundRect(0, 0, this._width, this._height, this._borderRadius);
        context.fill();

        // Draw border
        context.fillStyle = this._borderColor;
        context.roundRect(0, 0, this._width, this._height, this._borderRadius);
        context.fill();
        context.restore();

        // Draw placeholder
        if (!this._focused &amp;&amp; this._text === "") {
            context.beginPath();
            context.textDrawingMode = this._highQuality ? "path" : "glyph";
            context.antialias = "none";
            context.fillStyle = this._placeholderColor;
            context.font = this._fontStyle + " " + this._fontWeight + " " + this._fontSize + " " + this._fontFamily;
            context.textBaseline = this._baseline;

            var textHeight = parseInt(this._fontSize);
            var offset = this._padding;
            var textX = offset;
            var textY = 0;
            if (this._verticalAlign === "middle") {
                textY = this._height - textHeight;
            } else if (this._verticalAlign === "top") {
                textY = this._height / 2 - textHeight / 2;
            } else if (this._verticalAlign === "bottom") {
                textY = this._height - textHeight / 2;
            }
            context.fillText(this._placeholder, textX, textY);
        }
    },

    draw: function(context) {
        // Draw text
        context.save();
        context.beginPath();
        context.textDrawingMode = this._highQuality ? "path" : "glyph";
        context.antialias = "none";
        context.fillStyle = this._color;
        context.font = this._fontStyle + " " + this._fontWeight + " " + this._fontSize + " " + this._fontFamily;
        context.textBaseline = this._baseline;

        var text = this._type === "password" &amp;&amp; this._text !== this._placeholder ? this._text.replace(/./g, "\u25CF") : this._text;
        var textWidth = context.measureText(text).width;
        var textHeight = parseInt(this._fontSize);
        var offset = this._padding;
        var ratio = textWidth / (this._width - this._padding);
        if (ratio > 1) {
            text = text.substr(-1 * Math.floor(text.length / ratio));
        } else if (this._center) {
            offset = this._width / 2 - textWidth / 2;
        }
        var textX = offset;
        var textY = 0;
        if (this._verticalAlign === "middle") {
            textY = this._height - textHeight;
        } else if (this._verticalAlign === "top") {
            textY = this._height / 2 - textHeight / 2;
        } else if (this._verticalAlign === "bottom") {
            textY = this._height - textHeight / 2;
        }
        context.fillText(text, textX, textY);

        // Draw selection
        if (this._selectionStartPoint.x >= 0 &amp;&amp; this._selectionStartPoint.y >= 0 &amp;&amp; this._selectionLastPoint.x >= 0 &amp;&amp; this._selectionLastPoint.y >= 0) {
            for (var i = 0; i &lt; text.length - 1; i++) {
                var w1 = context.measureText(text.substr(0, i)).width;
                var w2 = context.measureText(text.substr(0, i + 1)).width;
                if (w1 &lt;= this._selectionStartPoint.x &amp;&amp; w2 >= this._selectionStartPoint.x) {
                    this._selection.start = i;
                }
                if (w1 &lt;= this._selectionLastPoint.x &amp;&amp; w2 >= this._selectionLastPoint.x) {
                    this._selection.end = i;
                }
            }
        }

        if (this._selection.start >= 0) {
            var paddingBorder = this._padding + this._borderWidth;
            var selectOffset = context.measureText(text.substring(0, this._selection.start)).width;
            var selectWidth = context.measureText(text.substring(this._selection.start, this._selection.end)).width;
            context.fillStyle = this._selectionColor;
            context.fillRect(paddingBorder + selectOffset, paddingBorder, selectWidth, this._height);
        }

        // Draw cursor
        if (this._cursor) {
            context.fillStyle = this._cursorColor;
            var cursorOffset = context.measureText(text.substring(0, this._cursorPos)).width;
            if (this._center) {
                cursorOffset += offset - this._padding;
            }
            context.fillRect(this._padding + cursorOffset, this._padding, 1, this._height - 2 * this._padding);
        }
        context.restore();
    }
}, module);
</code></pre>
        </article>
    </section>




          </div>
      </div>

        <br clear="both">

      <footer>
        Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Thu Nov 26 2015 15:54:21 GMT+0800 (CST)
        <br>
      </footer>
      <script> prettyPrint(); </script>
    </div>
  </body>
</html>
