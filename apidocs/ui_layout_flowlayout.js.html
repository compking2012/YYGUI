<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Porsche.js API documentation: Source: ui/layout/flowlayout.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link href="styles/bootstrap.css" rel="stylesheet">
    <link href="styles/docs.css" rel="stylesheet">
    <link href="styles/bootstrap-custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
  </head>
  <body>
    <header class="header navbar navbar-inverse">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#"><strong>Porsche.js</strong> API documentation</a>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <div class="row-fluid">
          <div class="span3">
              <h2><a href="index.html">Index</a></h2><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Modules</li><li><a href="module-AutoLayout.html">AutoLayout</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Classes</li><li><a href="App.html"><i class="icon-shield" style="color: #0186d1"></i> App</a></li><li><a href="EventEmitter.html"><i class="icon-shield" style="color: #0186d1"></i> EventEmitter</a></li><li><a href="CubicBezier.html"><i class="icon-shield" style="color: #0186d1"></i> CubicBezier</a></li><li><a href="Event.html"><i class="icon-shield" style="color: #0186d1"></i> Event</a></li><li><a href="GestureEvent.html"><i class="icon-shield" style="color: #0186d1"></i> GestureEvent</a></li><li><a href="InputEvent.html"><i class="icon-shield" style="color: #0186d1"></i> InputEvent</a></li><li><a href="KeyboardEvent.html"><i class="icon-shield" style="color: #0186d1"></i> KeyboardEvent</a></li><li><a href="TouchEvent.html"><i class="icon-shield" style="color: #0186d1"></i> TouchEvent</a></li><li><a href="UIEvent.html"><i class="icon-shield" style="color: #0186d1"></i> UIEvent</a></li><li><a href="initialize.html"><i class="icon-shield" style="color: #0186d1"></i> initialize</a></li><li><a href="LongPressRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> LongPressRecognizer</a></li><li><a href="PanRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> PanRecognizer</a></li><li><a href="PinchRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> PinchRecognizer</a></li><li><a href="RotationRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> RotationRecognizer</a></li><li><a href="SwipeRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> SwipeRecognizer</a></li><li><a href="TapRecognizer.html"><i class="icon-shield" style="color: #0186d1"></i> TapRecognizer</a></li><li><a href="module-AutoLayout-View.html"><i class="icon-shield" style="color: #0186d1"></i> View</a></li><li><a href="ColumnLayout.html"><i class="icon-shield" style="color: #0186d1"></i> ColumnLayout</a></li><li><a href="ColumnLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> ColumnLayoutParam</a></li><li><a href="FlowLayout.html"><i class="icon-shield" style="color: #0186d1"></i> FlowLayout</a></li><li><a href="FlowLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> FlowLayoutParam</a></li><li><a href="GridLayout.html"><i class="icon-shield" style="color: #0186d1"></i> GridLayout</a></li><li><a href="GridLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> GridLayoutParam</a></li><li><a href="Layout.html"><i class="icon-shield" style="color: #0186d1"></i> Layout</a></li><li><a href="RelativeLayout.html"><i class="icon-shield" style="color: #0186d1"></i> RelativeLayout</a></li><li><a href="RowLayout.html"><i class="icon-shield" style="color: #0186d1"></i> RowLayout</a></li><li><a href="RowLayoutParam.html"><i class="icon-shield" style="color: #0186d1"></i> RowLayoutParam</a></li><li><a href="Matrix.html"><i class="icon-shield" style="color: #0186d1"></i> Matrix</a></li><li><a href="Point.html"><i class="icon-shield" style="color: #0186d1"></i> Point</a></li><li><a href="Rectangle.html"><i class="icon-shield" style="color: #0186d1"></i> Rectangle</a></li><li><a href="BarCode.html"><i class="icon-shield" style="color: #0186d1"></i> BarCode</a></li><li><a href="Button.html"><i class="icon-shield" style="color: #0186d1"></i> Button</a></li><li><a href="Chart.html"><i class="icon-shield" style="color: #0186d1"></i> Chart</a></li><li><a href="CheckBox.html"><i class="icon-shield" style="color: #0186d1"></i> CheckBox</a></li><li><a href="CircleProgressView.html"><i class="icon-shield" style="color: #0186d1"></i> CircleProgressView</a></li><li><a href="CompositeView.html"><i class="icon-shield" style="color: #0186d1"></i> CompositeView</a></li><li><a href="Dialog.html"><i class="icon-shield" style="color: #0186d1"></i> Dialog</a></li><li><a href="ImageButton.html"><i class="icon-shield" style="color: #0186d1"></i> ImageButton</a></li><li><a href="ImageView.html"><i class="icon-shield" style="color: #0186d1"></i> ImageView</a></li><li><a href="Indicator.html"><i class="icon-shield" style="color: #0186d1"></i> Indicator</a></li><li><a href="ListItem.html"><i class="icon-shield" style="color: #0186d1"></i> ListItem</a></li><li><a href="ListView.html"><i class="icon-shield" style="color: #0186d1"></i> ListView</a></li><li><a href="ProgressView.html"><i class="icon-shield" style="color: #0186d1"></i> ProgressView</a></li><li><a href="QRCode.html"><i class="icon-shield" style="color: #0186d1"></i> QRCode</a></li><li><a href="RichTextView.html"><i class="icon-shield" style="color: #0186d1"></i> RichTextView</a></li><li><a href="ScrollableView.html"><i class="icon-shield" style="color: #0186d1"></i> ScrollableView</a></li><li><a href="ScrollBar.html"><i class="icon-shield" style="color: #0186d1"></i> ScrollBar</a></li><li><a href="Slider.html"><i class="icon-shield" style="color: #0186d1"></i> Slider</a></li><li><a href="StackView.html"><i class="icon-shield" style="color: #0186d1"></i> StackView</a></li><li><a href="SwipeView.html"><i class="icon-shield" style="color: #0186d1"></i> SwipeView</a></li><li><a href="Switch.html"><i class="icon-shield" style="color: #0186d1"></i> Switch</a></li><li><a href="TextField.html"><i class="icon-shield" style="color: #0186d1"></i> TextField</a></li><li><a href="TextView.html"><i class="icon-shield" style="color: #0186d1"></i> TextView</a></li><li><a href="View.html"><i class="icon-shield" style="color: #0186d1"></i> View</a></li><li><a href="Window.html"><i class="icon-shield" style="color: #0186d1"></i> Window</a></li><li><a href="YObject.html"><i class="icon-shield" style="color: #0186d1"></i> YObject</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Namespaces</li><li><a href="VisualFormat.html"><i class="icon-code"></i> VisualFormat</a></li></ul></div><div class="well well-small"><ul class="nav nav-list"><li class="nav-header">Global</li><li><a href="global.html#createInput"><i class="icon-globe" style="color: black;"></i> createInput</a></li><li><a href="global.html#add"><i class="icon-globe" style="color: black;"></i> add</a></li><li><a href="global.html#remove"><i class="icon-globe" style="color: black;"></i> remove</a></li><li><a href="global.html#emit"><i class="icon-globe" style="color: black;"></i> emit</a></li><li><a href="global.html#stop"><i class="icon-globe" style="color: black;"></i> stop</a></li><li><a href="global.html#recognize"><i class="icon-globe" style="color: black;"></i> recognize</a></li><li><a href="global.html#set"><i class="icon-globe" style="color: black;"></i> set</a></li><li><a href="global.html#recognizeWith"><i class="icon-globe" style="color: black;"></i> recognizeWith</a></li><li><a href="global.html#dropRecognizeWith"><i class="icon-globe" style="color: black;"></i> dropRecognizeWith</a></li><li><a href="global.html#requireFailure"><i class="icon-globe" style="color: black;"></i> requireFailure</a></li><li><a href="global.html#dropRequireFailure"><i class="icon-globe" style="color: black;"></i> dropRequireFailure</a></li><li><a href="global.html#hasRequireFailures"><i class="icon-globe" style="color: black;"></i> hasRequireFailures</a></li><li><a href="global.html#canRecognizeWith"><i class="icon-globe" style="color: black;"></i> canRecognizeWith</a></li><li><a href="global.html#tryEmit"><i class="icon-globe" style="color: black;"></i> tryEmit</a></li><li><a href="global.html#canEmit"><i class="icon-globe" style="color: black;"></i> canEmit</a></li><li><a href="global.html#stateStr"><i class="icon-globe" style="color: black;"></i> stateStr</a></li><li><a href="global.html#directionStr"><i class="icon-globe" style="color: black;"></i> directionStr</a></li><li><a href="global.html#process"><i class="icon-globe" style="color: black;"></i> process</a></li><li><a href="global.html#reset"><i class="icon-globe" style="color: black;"></i> reset</a></li><li><a href="global.html#handleInputEvent"><i class="icon-globe" style="color: black;"></i> handleInputEvent</a></li><li><a href="global.html#computeInputData"><i class="icon-globe" style="color: black;"></i> computeInputData</a></li><li><a href="global.html#simpleCloneInputData"><i class="icon-globe" style="color: black;"></i> simpleCloneInputData</a></li><li><a href="global.html#computeIntervalInputData"><i class="icon-globe" style="color: black;"></i> computeIntervalInputData</a></li><li><a href="global.html#getCenter"><i class="icon-globe" style="color: black;"></i> getCenter</a></li><li><a href="global.html#getVelocity"><i class="icon-globe" style="color: black;"></i> getVelocity</a></li><li><a href="global.html#getDirection"><i class="icon-globe" style="color: black;"></i> getDirection</a></li><li><a href="global.html#getDistance"><i class="icon-globe" style="color: black;"></i> getDistance</a></li><li><a href="global.html#getAngle"><i class="icon-globe" style="color: black;"></i> getAngle</a></li><li><a href="global.html#getRotation"><i class="icon-globe" style="color: black;"></i> getRotation</a></li><li><a href="global.html#getScale"><i class="icon-globe" style="color: black;"></i> getScale</a></li><li><a href="global.html#hasParent"><i class="icon-globe" style="color: black;"></i> hasParent</a></li><li><a href="global.html#normalizeSingleTouches"><i class="icon-globe" style="color: black;"></i> normalizeSingleTouches</a></li><li><a href="global.html#attrTest"><i class="icon-globe" style="color: black;"></i> attrTest</a></li><li><a href="global.html#getTouches"><i class="icon-globe" style="color: black;"></i> getTouches</a></li><li><a href="global.html#Attribute"><i class="icon-globe" style="color: black;"></i> Attribute</a></li><li><a href="global.html#Relation"><i class="icon-globe" style="color: black;"></i> Relation</a></li><li><a href="global.html#Priority"><i class="icon-globe" style="color: black;"></i> Priority</a></li><li><a href="global.html#value"><i class="icon-globe" style="color: black;"></i> value</a></li><li><a href="global.html#defineClass"><i class="icon-globe" style="color: black;"></i> defineClass</a></li><li><a href="global.html#getClass"><i class="icon-globe" style="color: black;"></i> getClass</a></li><li><a href="global.html#checkLineBreak"><i class="icon-globe" style="color: black;"></i> checkLineBreak</a></li><li><a href="global.html#isHex"><i class="icon-globe" style="color: black;"></i> isHex</a></li><li><a href="global.html#isNumber"><i class="icon-globe" style="color: black;"></i> isNumber</a></li><li><a href="global.html#isEmpty"><i class="icon-globe" style="color: black;"></i> isEmpty</a></li><li><a href="global.html#trim"><i class="icon-globe" style="color: black;"></i> trim</a></li><li><a href="global.html#focus"><i class="icon-globe" style="color: black;"></i> focus</a></li><li><a href="global.html#blur"><i class="icon-globe" style="color: black;"></i> blur</a></li><li><a href="global.html#addGestureRecognizer"><i class="icon-globe" style="color: black;"></i> addGestureRecognizer</a></li><li><a href="global.html#removeGestureRecognizer"><i class="icon-globe" style="color: black;"></i> removeGestureRecognizer</a></li><li><a href="global.html#toString"><i class="icon-globe" style="color: black;"></i> toString</a></li></ul></div>
          </div>

          <div class="span9">
              <h1 class="page-header">Source: ui/layout/flowlayout.js</h1>
              


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
* Porsche.js is licensed under the MIT license. If a copy of the
* MIT-license was not distributed with this file, You can obtain one at:
* http://opensource.org/licenses/mit-license.html.
*
* @author: Yang Yang (compking@gmail.com)
* @license MIT
* @copyright Yang Yang, 2015
*/

"use strict";
var Class = require("../../class");
var Layout = require("./layout");
var FlowLayoutParam = require("./flowlayoutparam");

/**
 * Flow Layout which can assign views as word editor
 * @class FlowLayout
 * @extends Layout
 */
Class.define("framework.ui.layout.FlowLayout", Layout, {
    initialize: function() {
        Layout.prototype.initialize.apply(this, arguments);
        this._align = "center";
        this._valign = "middle";
        this._lineSpacing = 5; // horizontal spacing between views and parent container
        this._header = 10;
        this._defaultparam = new FlowLayoutParam(-1, -1, this); // default values
        this._defaultparam.setMargin(0, 0, 0, 0);
    },

    /**
     * @name FlowLayout#lineSpacing
     * @type {Number}
     * @description the distance between current top edge and upper bottom edge
     */
    get lineSpacing() {
        return this._lineSpacing;
    },

    set lineSpacing(value) {
        this._lineSpacing = value;
        this.invalidate();
    },

    /**
     * @name FlowLayout#align
     * @type {String} such as left, right and center
     * @description the alignment for the views on the horizontal direction
     */
    get align() {
        return this._align;
    },

    set align(value) {
        this._align = value;
        this.invalidate();
    },

    /**
     * @name FlowLayout#valign
     * @type {String} such as top, bottom and middle
     * @description the alignment for the views on the vertical direction
     */
    get valign() {
        return this._valign;
    },

    set valign(value) {
        this._valign = value;
        this.invalidate();
    },

    get defaultParam() {
        return this._defaultparam;
    },

    /**
     * @name FlowLayout#header
     * @type {Number}
     * @description the distance between the first line and the top edge
     */
    get header() {
        return this._header;
    },

    set header(value) {
        this._header = value;
        this.invalidate();
    },

    destroy: function() {
        this._defaultparam = null;
        Layout.prototype.destroy.apply(this, arguments);
    },

    /**
     * @method FlowLayout#getParamAtIndex
     * @param {Number} index of the child FlowLayoutParam
     * @description return the child FlowLayoutParam of index
     * @override
     */
    getParamAtIndex: function(index) {
        if (this._childparam[index] ===  undefined) {
            this._childparam[index] = new FlowLayoutParam(-1, -1, this);
            this._childparam[index]._margin = this._defaultparam._margin;
            this._childparam[index]._itemSpacing = this._defaultparam._itemSpacing;
        }
        return this._childparam[index];
    },

    /**
     * @method FlowLayout#calculateFrame
     * @description calculate position of all the children views
     * @override
     */
    calculateFrame: function() {
        var linesInfo = this.getLinesInfo();
        if (linesInfo === null) {
            return;
        }
        var layoutParam = null;
        var l = 0, beginIndex = 0, endIndex = 0, linesnum = 0;
        if (this._align === "right") {
            l = this._associatedView.width;
            while (beiginIndex &lt; this._associatedView._children.length) {
                endIndex = beginIndex + linesInfo[linesnum].viewnum;
                for (var i = endIndex - 1; i >= beginIndex; i--) {
                    if (this._childparam[i] !== undefined &amp;&amp; this._childparam[i]._set === 1) {
                        layoutParam = this._childparam[i];
                    }
                    else {
                        layoutParam = this._defaultparam;
                    }
                    var child = this._associatedView._children[i];
                    child.left = l - layoutParam._itemSpacing - child.width;
                    child.top = this.getHeight(linesInfo[linesnum].offset, linesInfo[linesnum].maxheight, child.height);
                    l = child.left;
                }
                beginIndex = endIndex;
                l = this._associatedView.width;
                linesnum++;
            }
        } else if (this._align === "center"){
            var rowWidth = 0, endIndex;
            while ( beginIndex &lt; this._associatedView._children.length) {
                endIndex = beginIndex + linesInfo[linesnum].viewnum;
                rowWidth = 0;
                for (var i = endIndex - 1; i >= beginIndex; i--) {
                    rowWidth += this._associatedView._children[i].width;
                     if (this._childparam[i] !== undefined &amp;&amp; this._childparam[i]._set === 1) {
                        layoutParam = this._childparam[i];
                    }
                    else {
                        layoutParam = this._defaultparam;
                    }
                    rowWidth += layoutParam._itemSpacing;
                }
                rowWidth -= layoutParam._itemSpacing;
                l = (this._associatedView.width - rowWidth) / 2;
                for (var i = beginIndex; i &lt; endIndex; i++) {
                    if (this._childparam[i] !== undefined &amp;&amp; this._childparam[i]._set === 1) {
                        layoutParam = this._childparam[i];
                    }
                    else {
                        layoutParam = this._defaultparam;
                    }
                    var child = this._associatedView._children[i];
                    child.left = l;
                    child.top = this.getHeight(linesInfo[linesnum].offset, linesInfo[linesnum].maxheight, child.height);
                    l += layoutParam._itemSpacing;
                    l += child.width;
                }
                beginIndex = endIndex;
                linesnum++;
            }
        } else {
            while ( beginIndex &lt; this._associatedView._children.length) {
                endIndex = beginIndex + linesInfo[linesnum].viewnum;
                for (var i = beginIndex; i &lt; endIndex; i++) {
                    if (this._childparam[i] !== undefined &amp;&amp; this._childparam[i]._set === 1) {
                        layoutParam = this._childparam[i];
                    }
                    else {
                        layoutParam = this._defaultparam;
                    }
                    var child = this._associatedView._children[i];
                    child.left = l + layoutParam._itemSpacing;
                    child.top = this.getHeight(linesInfo[linesnum].offset, linesInfo[linesnum].maxheight, child.height);
                    l += layoutParam._itemSpacing;
                    l += child.width;
                }
                beginIndex = endIndex;
                linesnum++;
                l = 0;
            }
        }
        // code here for debug log
        for (var i = 0; i &lt; this._associatedView._children.length; i++) {
            var child = this._associatedView._children[i];
        }
    },

    /**
     * @method FlowLayout#getLinesInfo
     * @description calculate and return related lineinfo of all childviews
     * @private
     */
    getLinesInfo: function() {
        var maxHeight = 0, lineNum = 0, viewNum = 0;
        var startpos = 0;
        var linesInfo = [], offsetY = this._header;
        for (var i = 0; i &lt; this._associatedView._children.length; i++) {
            var child = this._associatedView._children[i];
            var layoutParam = null;
            if (this._childparam[i] === undefined) {
                this._childparam[i] = new FlowLayoutParam(-1, -1, this);
            }
            this._childPosition[i] = {left: child.left, top: child.top, width: child.width, height: child.height};
            if (this._childparam[i]._set === 1) {
                layoutParam = this._childparam[i];
            }
            else {
                layoutParam = this._defaultparam;
            }
            startpos += layoutParam._itemSpacing;
            startpos += child.width;
            if (startpos > this._associatedView.width) {
                linesInfo[lineNum++] = {offset: offsetY, maxheight: maxHeight, viewnum: viewNum};
                offsetY += maxHeight;
                offsetY += this._lineSpacing;
                maxHeight = child.height;
                startpos = layoutParam._itemSpacing + child.width;
                viewNum = 1;
                continue;
            }
            if (maxHeight &lt; child.height) {
                maxHeight = child.height;
            }
            viewNum++;
        }
        linesInfo[lineNum] = {offset: offsetY, maxheight: maxHeight, viewnum: viewNum};
        return linesInfo;
    },

    /**
     * @method FlowLayout#getHeight
     * @param {Number} the upper baseline of the current line
     * @param {Number} the max height of all views in the current line
     * @param {Number} the height of the current view
     * @description calculate height value of the current child view
     * @private
     */
    getHeight: function(baseline, maxheight, viewheight) {
        if (this._valign === "middle") {
            return baseline + (maxheight - viewheight) / 2;
        } else if (this._valign === "top") {
            return baseline;
        } else if (this._valign === "bottom") {
            return baseline + maxheight - viewheight;
        } else {
            return baseline + (maxheight - viewheight) / 2;
        }
    }


}, module);
</code></pre>
        </article>
    </section>




          </div>
      </div>

        <br clear="both">

      <footer>
        Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Thu Nov 26 2015 15:54:21 GMT+0800 (CST)
        <br>
      </footer>
      <script> prettyPrint(); </script>
    </div>
  </body>
</html>
